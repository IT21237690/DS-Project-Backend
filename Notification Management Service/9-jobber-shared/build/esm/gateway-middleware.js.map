{"version":3,"file":"gateway-middleware.js","names":["JWT","NotAuthorizedError","tokens","verifyGatewayRequest","req","_res","next","_req$headers","_req$headers2","headers","gatewaytoken","token","payload","verify","includes","id","error"],"sources":["../../src/gateway-middleware.ts"],"sourcesContent":["import JWT from 'jsonwebtoken';\r\nimport { Request, Response, NextFunction } from 'express';\r\nimport { NotAuthorizedError } from './error-handler';\r\n\r\nconst tokens: string[] = ['auth', 'seller', 'gig', 'search', 'buyer', 'message', 'order', 'review'];\r\n\r\nexport function verifyGatewayRequest(req: Request, _res: Response, next: NextFunction): void {\r\n  if (!req.headers?.gatewaytoken) {\r\n    throw new NotAuthorizedError('Invalid request', 'verifyGatewayRequest() method: Request not coming from api gateway');\r\n  }\r\n  const token: string = req.headers?.gatewaytoken as string;\r\n  if (!token) {\r\n    throw new NotAuthorizedError('Invalid request', 'verifyGatewayRequest() method: Request not coming from api gateway');\r\n  }\r\n\r\n  try {\r\n    const payload: { id: string; iat: number } = JWT.verify(token, '') as { id: string; iat: number };\r\n    if (!tokens.includes(payload.id)) {\r\n      throw new NotAuthorizedError('Invalid request', 'verifyGatewayRequest() method: Request payload is invalid');\r\n    }\r\n  } catch (error) {\r\n    throw new NotAuthorizedError('Invalid request', 'verifyGatewayRequest() method: Request not coming from api gateway');\r\n  }\r\n  next();\r\n}"],"mappings":"AAAA,OAAOA,GAAG,MAAM,cAAc;AAE9B,SAASC,kBAAkB,QAAQ,iBAAiB;AAEpD,MAAMC,MAAgB,GAAG,CAAC,MAAM,EAAE,QAAQ,EAAE,KAAK,EAAE,QAAQ,EAAE,OAAO,EAAE,SAAS,EAAE,OAAO,EAAE,QAAQ,CAAC;AAEnG,OAAO,SAASC,oBAAoBA,CAACC,GAAY,EAAEC,IAAc,EAAEC,IAAkB,EAAQ;EAAA,IAAAC,YAAA,EAAAC,aAAA;EAC3F,IAAI,GAAAD,YAAA,GAACH,GAAG,CAACK,OAAO,aAAXF,YAAA,CAAaG,YAAY,GAAE;IAC9B,MAAM,IAAIT,kBAAkB,CAAC,iBAAiB,EAAE,oEAAoE,CAAC;EACvH;EACA,MAAMU,KAAa,IAAAH,aAAA,GAAGJ,GAAG,CAACK,OAAO,qBAAXD,aAAA,CAAaE,YAAsB;EACzD,IAAI,CAACC,KAAK,EAAE;IACV,MAAM,IAAIV,kBAAkB,CAAC,iBAAiB,EAAE,oEAAoE,CAAC;EACvH;EAEA,IAAI;IACF,MAAMW,OAAoC,GAAGZ,GAAG,CAACa,MAAM,CAACF,KAAK,EAAE,EAAE,CAAgC;IACjG,IAAI,CAACT,MAAM,CAACY,QAAQ,CAACF,OAAO,CAACG,EAAE,CAAC,EAAE;MAChC,MAAM,IAAId,kBAAkB,CAAC,iBAAiB,EAAE,2DAA2D,CAAC;IAC9G;EACF,CAAC,CAAC,OAAOe,KAAK,EAAE;IACd,MAAM,IAAIf,kBAAkB,CAAC,iBAAiB,EAAE,oEAAoE,CAAC;EACvH;EACAK,IAAI,CAAC,CAAC;AACR","ignoreList":[]}